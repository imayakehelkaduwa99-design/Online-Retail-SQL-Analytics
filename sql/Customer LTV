CREATE OR REPLACE TABLE
  `retail-analytics-478402.retail_analytics.customer_ltv` AS
SELECT
  CustomerID AS customer_id,
  SUM(Quantity * UnitPrice) AS total_revenue,
  COUNT(DISTINCT InvoiceNo) AS total_orders
FROM `retail-analytics-478402.retail_analytics.online_retail_cleaned`
GROUP BY CustomerID;

SELECT *
FROM `retail-analytics-478402.retail_analytics.customer_ltv`
ORDER BY total_revenue DESC
LIMIT 10;

SELECT *
FROM `retail-analytics-478402.retail_analytics.customer_ltv`
ORDER BY total_orders DESC
LIMIT 10;

SELECT *
FROM `retail-analytics-478402.retail_analytics.customer_ltv`
ORDER BY total_revenue ASC
LIMIT 10;
